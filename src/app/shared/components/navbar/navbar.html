<nav class="bg-primary text-black shadow-lg">
  <div class="container mx-auto px-4 py-3 flex justify-between items-center">
    <!-- Logo -->
    <a
      routerLink="/home"
      class="text-xl text-black font-bold tracking-wide hover:opacity-90 transition"
    >
      ðŸŽ¬ Movie App
    </a>

    <!-- Navigation Links -->
    <!-- Desktop Menu -->
    <ul class="hidden md:flex space-x-6 list-none">
      <li>
        <a routerLink="/home" routerLinkActive="font-semibold">{{ t('home') }}</a>
      </li>

      <app-button-with-menu class="text-black"></app-button-with-menu>

      <li>
        <a
          routerLink="/lists"
          routerLinkActive="active"
          class="font-semibold"
          aria-label="View My Lists"
        >
          {{ t('viewMyLists') }}
        </a>
      </li>

      <li>
        <a
          routerLink="/wishlist"
          routerLinkActive="active"
          [routerLinkActiveOptions]="{ exact: true }"
          aria-label="Wish List"
          class="wishlist-link"
          title="Wish List"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            width="20"
            height="20"
            class="heart"
          >
            <path
              d="M12 21s-6.2-4.35-9.33-7.48C.82 11.67 1 8.5 3.2 6.6c2.28-1.96 5.3-1.2 6.8.73C11.5 5.4 14.52 4.64 16.8 6.6c2.2 1.9 2.38 5.07.53 6.92C18.2 14.9 12 21 12 21z"
            />
          </svg>
          @let wishlistCount = (count$ | async) ?? 0; @if (wishlistCount > 0) {
          <span class="wishlist-badge" aria-label="Wishlist count">{{ wishlistCount }}</span>
          }
        </a>
      </li>
    </ul>

    <!-- Mobile Hamburger -->
    <button
      class="md:hidden text-black focus:outline-none"
      (click)="mobileMenuOpen = true"
      aria-label="Open menu"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>

    <!-- Mobile Drawer -->
    <div
      class="fixed inset-0 bg-black/50 z-50 transition-opacity"
      [class.hidden]="!mobileMenuOpen"
      (click)="mobileMenuOpen = false"
    >
      <div
        class="absolute top-0 left-0 h-full w-64 bg-white text-black shadow-2xl transform transition-transform duration-300"
        [class.-translate-x-full]="!mobileMenuOpen"
        [class.translate-x-0]="mobileMenuOpen"
        (click)="$event.stopPropagation()"
      >
        <!-- Header -->
        <div class="flex items-center justify-between p-4 border-b">
          <span class="text-lg font-semibold">Menu</span>
          <button (click)="mobileMenuOpen = false" class="text-2xl leading-none">&times;</button>
        </div>

        <!-- Links -->
        <ul class="flex flex-col p-4 space-y-4">
          <li>
            <a (click)="mobileMenuOpen = false" routerLink="/home" routerLinkActive="font-semibold">
              {{ t('home') }}
            </a>
          </li>
          <li>
            <app-button-with-menu class="text-black"></app-button-with-menu>
          </li>

          <li>
            <a (click)="mobileMenuOpen = false" routerLink="/lists" class="font-semibold">
              {{ t('viewMyLists') }}
            </a>
          </li>

          <li>
            <a
              (click)="mobileMenuOpen = false"
              routerLink="/wishlist"
              routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: true }"
              class="flex items-center gap-2"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 24 24"
                width="20"
                height="20"
                class="heart"
              >
                <path
                  d="M12 21s-6.2-4.35-9.33-7.48C.82 11.67 1 8.5 3.2 6.6c2.28-1.96 5.3-1.2 6.8.73C11.5 5.4 14.52 4.64 16.8 6.6c2.2 1.9 2.38 5.07.53 6.92C18.2 14.9 12 21 12 21z"
                />
              </svg>
              @let wishlistCountMobile = (count$ | async) ?? 0; @if (wishlistCountMobile > 0) {
              <span class="wishlist-badge" aria-label="Wishlist count">{{
                wishlistCountMobile
              }}</span>
              }
            </a>
          </li>
        </ul>
      </div>
    </div>

    <!-- Right side (Account + Language) -->
    <div class="flex items-center space-x-4">
      <!-- Language Dropdown -->
      <div class="relative">
        <select
          class="text-black rounded px-2 py-1 text-sm focus:outline-none"
          [ngModel]="currentLanguage()"
          (ngModelChange)="changeLanguage($event)"
        >
          @for (lang of languages; track lang.code) {
          <option [value]="lang.code">{{ lang.name }}</option>
          }
        </select>
      </div>

      <!-- Account Button / Auth Links -->
      <uL class="list-none flex">
        @if (isLoggedIn()) {

        <li>
          <button
            (click)="openAccountDrawer()"
            aria-label="Account menu"
            class="flex items-center justify-center w-10 h-10 rounded-full bg-white text-black hover:bg-gray-100 transition"
          >
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
            >
              <path d="M12 12c2.7 0 5-2.5 5-5.5S14.7 1 12 1 7 3.5 7 6.5 9.3 12 12 12Z" />
              <path d="M3 22c0-3.9 4-7 9-7s9 3.1 9 7" stroke-linecap="round" />
            </svg>
          </button>
        </li>
        } @else {
        <li>
          <a routerLink="/login" class="px-3 py-1 rounded-full text-black"> {{ t('login') }} </a>
        </li>
        <li>
          <a routerLink="/register" class="px-3 py-1 rounded-full text-black"> {{ t('signup') }}</a>
        </li>
        }
      </uL>
      @if (!isCurrentRoute('/login') && !isCurrentRoute('/register') && isLoggedIn()) {
      <div
        class="fixed inset-0 bg-black/50 z-50"
        [class.hidden]="!accountDrawerOpen"
        (click)="closeAccountDrawer()"
      >
        <div
          class="absolute right-0 top-0 h-full w-80 bg-white text-black shadow-2xl transform transition-transform duration-300"
          [class.translate-x-0]="accountDrawerOpen"
          [class.translate-x-full]="!accountDrawerOpen"
          (click)="$event.stopPropagation()"
        >
          <!-- Header -->
          <div class="flex items-center justify-between p-4 border-b">
            <div class="flex items-center space-x-3">
              <div
                class="w-10 h-10 rounded-full bg-gray-300 flex items-center justify-center text-lg font-semibold"
              >
                {{ (displayName() || email() || 'U').slice(0, 1).toUpperCase() }}
              </div>
              <div>
                <div class="font-semibold">{{ displayName() || 'No name' }}</div>
                <div class="text-sm text-gray-600">{{ email() }}</div>
              </div>
            </div>
            <button
              (click)="closeAccountDrawer()"
              class="text-gray-500 hover:text-black text-2xl leading-none"
            >
              Ã—
            </button>
          </div>

          <!-- Actions -->
          <div class="p-4 space-y-2">
            <button
              (click)="goChangePassword()"
              class="w-full text-left px-4 py-2 rounded hover:bg-gray-100 transition"
            >
              Change password
            </button>
            <button
              (click)="goChangeUsername()"
              class="w-full text-left px-4 py-2 rounded hover:bg-gray-100 transition"
            >
              Change username
            </button>
            <button
              (click)="deleteAccount()"
              class="w-full text-left px-4 py-2 rounded text-red-600 hover:bg-red-50 transition"
            >
              Delete account
            </button>
          </div>

          <!-- Footer -->
          <div class="p-4 border-t">
            <button
              (click)="logout()"
              class="w-full py-2 rounded bg-red-600 text-white hover:bg-red-700 transition"
            >
              Logout
            </button>
          </div>
        </div>
      </div>
      } @if (passwordModalOpen) {
      <div class="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
        <div
          class="bg-white text-black rounded-xl shadow-lg p-6 w-full max-w-sm"
          (click)="$event.stopPropagation()"
        >
          <h3 class="text-lg font-semibold mb-4">Change Password</h3>

          <input
            type="password"
            [(ngModel)]="currentPassword"
            placeholder="Current Password"
            class="w-full px-3 py-2 border rounded mb-2 focus:outline-none focus:ring-2 focus:ring-primary"
          />
          <input
            type="password"
            [(ngModel)]="newPassword"
            placeholder="New Password"
            class="w-full px-3 py-2 border rounded mb-2 focus:outline-none focus:ring-2 focus:ring-primary"
          />
          <input
            type="password"
            [(ngModel)]="confirmPassword"
            placeholder="Confirm New Password"
            class="w-full px-3 py-2 border rounded mb-2 focus:outline-none focus:ring-2 focus:ring-primary"
          />

          @if (passwordError) {
          <p class="text-red-500 text-sm mb-2">{{ passwordError }}</p>
          } @if (passwordSuccess) {
          <p class="text-green-600 text-sm mb-2">{{ passwordSuccess }}</p>
          }

          <div class="flex justify-end space-x-2">
            <button
              (click)="closePasswordModal()"
              class="px-3 py-1 bg-gray-200 rounded hover:bg-gray-300"
            >
              Cancel
            </button>
            <button
              (click)="savePassword()"
              class="px-3 py-1 bg-primary text-white rounded hover:bg-primary/90"
            >
              Save
            </button>
          </div>
        </div>
      </div>
      }
    </div>
  </div>
</nav>
