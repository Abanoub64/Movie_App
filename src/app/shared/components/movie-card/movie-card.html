<div class="card style_1 relative">
  <div (click)="goToMovie(movie.id)" class="image relative">
    <div class="wrapper glyphicons_v2 picture grey no_image_holder">
      <a class="image" [routerLink]="['/movie', movie.id]" [title]="movie.title">
        <img alt=""
          loading="lazy"
          class="poster w-full"
          [src]="posterUrl"
          [attr.srcset]="posterUrl + ' 1x, ' + posterUrl2x + ' 2x'"
          [alt]="movie.title"
        />
      </a>
    </div>

    <button
      type="button"
      class="absolute top-2 right-2 w-9 h-9 rounded-full bg-[rgba(0,0,0,.6)] text-white flex items-center justify-center hover:bg-black/70"
      aria-label="More options"
      (click)="onMenuClick($event)"
    >
      <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
        <circle cx="12" cy="5" r="2"></circle>
        <circle cx="12" cy="12" r="2"></circle>
        <circle cx="12" cy="19" r="2"></circle>
      </svg>
    </button>

    @if (menuOpen) {
      <div class="mc-menu absolute top-12 right-2 z-20">
        <ul class="mc-menu-list">
          @for (opt of menuOptions; track opt.label) {
            <li (click)="handleOption(opt.key, $event)">
              <span class="mi">{{ opt.icon }}</span> {{ opt.label }}
            </li>
          }
        </ul>
      </div>
    }
  </div>

  <div class="content flex flex-col items-start gap-2" (click)="goToMovie(movie.id)">
    <div class="consensus">
      <div class="outer_ring" [style.background]="trackColor">
        <div class="user_score_chart" [style.background]="scoreColor">
          <div class="percent">
            <span class="icon" [attr.data-percent]="userScorePercent"></span>
          </div>
        </div>
      </div>
    </div>

    <h2>
      <a [routerLink]="['/movie', movie.id]" [title]="movie.title">{{ movie.title }}</a>
    </h2>

    <p>{{ displayDate }}</p>

    <!-- ❤️ زر الويش لست (Toggle) -->
    <button
      type="button"
      class="wishlist-btn"
      [class.active]="inWishlist"
      [disabled]="toggling"
      (click)="toggleWishlist($event)"
      [attr.aria-pressed]="inWishlist"
      aria-label="Toggle wishlist"
    >
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path
          d="M12 21s-6.2-4.35-9.33-7.48C.82 11.67 1 8.5 3.2 6.6c2.28-1.96 5.3-1.2 6.8.73C11.5 5.4 14.52 4.64 16.8 6.6c2.2 1.9 2.38 5.07.53 6.92C18.2 14.9 12 21 12 21z"
          [attr.fill]="inWishlist ? '#FFE353' : 'none'"
          [attr.stroke]="inWishlist ? '#000000' : '#9CA3AF'"
          stroke-width="1.5"
        />
      </svg>
    </button>
  </div>

  <div class="hover" [attr.data-id]="movie.id"></div>
</div>
